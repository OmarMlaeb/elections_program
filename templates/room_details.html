<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Room {{ room_id }} Full Info</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; background: #f9f9f9; }
        canvas { max-width: 400px; margin: 20px auto; display: block; }

        .action-button {
            padding: 8px 16px;
            background-color: white;
            color: black;
            border: 1px solid black;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-button:hover {
            background-color: #f0f0f0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>

   <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center; flex-wrap: wrap;">
        <button onclick="location.reload()" class="action-button">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>

        {% if role == "admin" %}
            <a href="{{ url_for('dashboard') }}">
                <button class="action-button">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
            </a>
        {% endif %}

        <a href="{{ url_for('logout') }}">
            <button class="action-button">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </a>

    </div>

    <h2>ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª - Ø§Ù„ØºØ±ÙØ© Ø±Ù‚Ù… {{ room_id }}</h2>

    <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> {{ total }}</p>
    <p><strong>ØµÙˆÙ‘Øª:</strong> {{ voted }}</p>
    <p><strong>Ù„Ù… ÙŠØµÙˆÙ‘Øª:</strong> {{ not_voted }}</p>

    <canvas id="voteChart"></canvas>

    <script>
        const ctx = document.getElementById('voteChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['âœ… ØµÙˆÙ‘Øª', 'âŒ Ù„Ù… ÙŠØµÙˆÙ‘Øª'],
                datasets: [{
                    data: JSON.parse('{{ [voted, not_voted] | tojson | safe }}'),
                    backgroundColor: ['#4caf50', '#f44336']
                }]
            },
            options: {
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    </script>

    <h3 style="margin-top:40px;">ğŸ“‹ Ù†Ø³Ø¨ Ø§Ù„ØªØµÙˆÙŠØª Ø­Ø³Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©:</h3>

    <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
        <thead>
            <tr style="background-color:#e0e0e0;">
                <th style="padding: 10px; border: 1px solid #ccc;">Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                <th style="padding: 10px; border: 1px solid #ccc;">ØµÙˆÙ‘Øª</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Ù„Ù… ÙŠØµÙˆÙ‘Øª</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Ø§Ù„Ù†Ø³Ø¨Ø© (%)</th>
            </tr>
        </thead>
        <tbody>
            {% for f in family_stats %}
            <tr style="text-align: center;">
                <td style="padding: 8px; border: 1px solid #ccc;">{{ f.name }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ f.total }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ f.voted }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ f.not_voted }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ f.percent }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <canvas id="familyChart" style="width:100%; max-width:1200px; height:600px; margin-top:40px;"></canvas>

    <script>
        const familyLabels = JSON.parse('{{ family_stats | map(attribute="name") | list | tojson | safe }}');
        const familyPercents = JSON.parse('{{ family_stats | map(attribute="percent") | list | tojson | safe }}');

        const ctxBar = document.getElementById('familyChart').getContext('2d');
        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: familyLabels,
                datasets: [{
                    label: 'Ù†Ø³Ø¨Ø© Ø§Ù„ØªØµÙˆÙŠØª (%)',
                    data: familyPercents,
                    backgroundColor: '#1E88E5'
                }]
            },
            options: {
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 100
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>

    <h3 style="margin-top: 60px;">ğŸ“‹ Ù†Ø³Ø¨ Ø§Ù„ØªØµÙˆÙŠØª Ø­Ø³Ø¨ Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯ (ÙƒÙ„ Ø±Ù‚Ù… Ø¹Ù„Ù‰ Ø­Ø¯Ø©):</h3>

    <table style="width:100%; border-collapse: collapse; margin-top: 10px;">
        <thead>
            <tr style="background-color:#f9f9f9;">
                <th style="padding: 10px; border: 1px solid #ccc;">Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                <th style="padding: 10px; border: 1px solid #ccc;">ØµÙˆÙ‘Øª</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Ù„Ù… ÙŠØµÙˆÙ‘Øª</th>
                <th style="padding: 10px; border: 1px solid #ccc;">Ø§Ù„Ù†Ø³Ø¨Ø© (%)</th>
            </tr>
        </thead>
        <tbody>
            {% for r in reg_number_stats %}
            <tr style="text-align: center;">
                <td style="padding: 8px; border: 1px solid #ccc;">{{ r.reg_number }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ r.total }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ r.voted }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ r.not_voted }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ r.percent }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</body>
</html>
